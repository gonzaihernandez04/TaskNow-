(()=>{!async function(){try{const e="/api/tareas?urlProyecto="+r(),o=await fetch(e),n=await o.json();t=n.tareas,a()}catch(e){console.log(e)}}(),function(){const o=document.querySelectorAll("#filtro");o&&o.forEach(o=>{o.onclick=()=>{!function(o){if(""==o.value)return e=[],void a();e=t.filter(e=>e.estado==o.value),a()}(o)}})}(),document.querySelector(".contenido-subtitulo").style.maxHeight="300px";let e=[],t=[];function a(){document.querySelector("#listado-tareas").innerHTML="",function(){const e=t.filter(e=>"0"==e.estado),a=document.querySelector(".pendientes");if(0==e)return void(a.disabled=!0);a.disabled&&(a.disabled=!1)}(),function(){const e=t.filter(e=>"1"==e.estado),a=document.querySelector(".completadas");if(0==e)return void(a.disabled=!0);a.disabled&&(a.disabled=!1)}();const r=document.querySelector("#listado-tareas"),i=0==e.length?t:e;if(0==i.length){const e=document.createElement("LI");return e.textContent="No hay tareas",e.classList.add("alerta","aviso"),e.style.textAlign="center",void r.appendChild(e)}const d={0:"Pendiente",1:"Completada"};i.forEach(e=>{const i=document.createElement("LI");i.dataset.tareaId=e.id,i.classList.add("tarea");const s=document.createElement("P");s.textContent=e.nombre,s.ondblclick=()=>{o(!0,{...e})};const l=document.createElement("DIV");l.classList.add("opciones");const u=document.createElement("BUTTON");u.classList.add("estado-tarea"),u.classList.add(""+d[e.estado].toLowerCase()),u.textContent=d[e.estado],u.dataset.estadoTarea=e.estado;const m=document.createElement("BUTTON");m.classList.add("eliminar-tarea"),m.textContent="Eliminar tarea",m.dataset.idTarea=e.id,l.appendChild(u),l.appendChild(m),i.appendChild(s),i.appendChild(l),r.appendChild(i),u.onclick=()=>{!function({...e}){const t="0"===e.estado?"1":"0";e.estado=t,n(e)}(e)},m.onclick=()=>{!function(e){Swal.fire({title:"多Estas seguro que queres eliminar la tarea?",showDenyButton:!0,confirmButtonText:"Si, estoy seguro",cancelButtonText:"No"}).then(o=>{o.isConfirmed&&async function(e){const{id:o,estado:n,nombre:r,idProyecto:i}=e,d=new FormData;d.append("id",o),d.append("idProyecto",i),d.append("nombre",r),d.append("estado",n);const s=await fetch("/api/tarea/eliminar",{method:"POST",body:d});"exito"===(await s.json()).tipo?(c("success","Exito","Tarea borrada correctamente"),t=t.filter(e=>e.id!=o),a()):c("error","Oops..","La tarea no se pudo borrar")}(e)})}(e)}})}function o(e=!1,o){const i=document.createElement("DIV");i.classList.add("modal"),i.innerHTML=`\n            <form class="formulario nueva-tarea">\n                <legend>${e?"Editar tarea":"A単ade una nueva tarea"}</legend>\n                <div class="campo">\n                    <label>Tarea</label>\n                    <input type="tarea" name="tarea" placeholder="${e?"Editar tarea":"A単ade una nueva tarea al proyecto actual"}" id="tarea" value="${o?o.nombre:""}"/>\n                </div>\n                <div class="opciones">\n                    <input type="submit" class="submit-nueva-tarea" value="${e?"Guardar los cambios":"A単ade una nueva tarea"}"/>\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>\n            </form>\n        `,setTimeout(()=>{document.querySelector(".formulario").classList.add("animar")},0),i.addEventListener("click",d=>{if(d.preventDefault(),d.target.classList.contains("cerrar-modal")||d.target.classList.contains("modal")){document.querySelector(".formulario").classList.add("cerrar"),setTimeout(()=>{i.remove()},500)}if(d.target.classList.contains("submit-nueva-tarea")){const i=document.querySelector("#tarea").value.trim();if(""===o)return void function(e,t,a){const o=document.querySelector(".alerta");o&&o.remove();const n=document.createElement("DIV");n.classList.add("alerta",t),n.textContent=e,a.parentElement.insertBefore(n,a.nextElementSibling),setTimeout(()=>{n.remove()},6e3)}("El nombre de la tarea es obligatorio","error",document.querySelector(".formulario legend"));if(!e)return void async function(e){const o=new FormData;o.append("nombre",e),o.append("idProyecto",r());try{const n="/api/tarea",r=await fetch(n,{method:"POST",body:o}),i=await r.json();if(c("success","Exito","Tarea creada correctamente"),"exito"===i.tipo){const o={id:i.id.toString(),nombre:e,estado:"0",idProyecto:i.idProyecto};t=[...t,o],a();const n=document.querySelector(".modal");n&&n.remove()}}catch(e){console.log(e)}}(i);o.nombre=i,n(o)}}),document.querySelector(".dashboard").appendChild(i)}async function n(e){const{id:o,estado:n,nombre:i}=e,d=new FormData;d.append("id",o),d.append("nombre",i),d.append("estado",n),d.append("urlProyecto",r());try{const e="/api/tarea/actualizar",r=await fetch(e,{method:"POST",body:d});if("exito"===(await r.json()).tipo){c("success","Exito","Tarea actualizada correctamente"),t=t.map(e=>(e.id===o&&(e.estado=n,e.nombre=i),e));const e=document.querySelector(".modal");e&&e.remove(),a()}}catch(e){console.log(e)}}function r(){const e=new URLSearchParams(window.location.search);return Object.fromEntries(e.entries()).urlProyecto}function c(e,t,a){Swal.fire({icon:e,title:t,text:a,button:"OK"})}document.querySelector("#agregar-tarea").addEventListener("click",()=>{o()})})();