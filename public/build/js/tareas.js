(()=>{!async function(){try{const a="http://localhost:3000/api/tareas?urlProyecto="+n(),o=await fetch(a),r=await o.json();e=r.tareas,t()}catch(e){console.log(e)}}();let e=[];function t(){document.querySelector("#listado-tareas").innerHTML="";const n=document.querySelector("#listado-tareas");if(0==e.length){const e=document.createElement("LI");return e.textContent="No hay tareas",e.classList.add("alerta","aviso"),e.style.textAlign="center",void n.appendChild(e)}const c={0:"Pendiente",1:"Completada"};e.forEach(s=>{const i=document.createElement("LI");i.dataset.tareaId=s.id,i.classList.add("tarea");const d=document.createElement("P");d.textContent=s.nombre,d.ondblclick=()=>{a(!0,{...s})};const l=document.createElement("DIV");l.classList.add("opciones");const u=document.createElement("BUTTON");u.classList.add("estado-tarea"),u.classList.add(""+c[s.estado].toLowerCase()),u.textContent=c[s.estado],u.dataset.estadoTarea=s.estado;const m=document.createElement("BUTTON");m.classList.add("eliminar-tarea"),m.textContent="Eliminar tarea",m.dataset.idTarea=s.id,l.appendChild(u),l.appendChild(m),i.appendChild(d),i.appendChild(l),n.appendChild(i),u.onclick=()=>{!function({...e}){const t="0"===e.estado?"1":"0";e.estado=t,o(e)}(s)},m.onclick=()=>{!function(a){Swal.fire({title:"多Estas seguro que queres eliminar la tarea?",showDenyButton:!0,confirmButtonText:"Si, estoy seguro",cancelButtonText:"No"}).then(o=>{o.isConfirmed&&async function(a){const{id:o,estado:n,nombre:c,idProyecto:s}=a,i=new FormData;i.append("id",o),i.append("idProyecto",s),i.append("nombre",c),i.append("estado",n);const d=await fetch("http://localhost:3000/api/tarea/eliminar",{method:"POST",body:i});"exito"===(await d.json()).tipo?(r("success","Exito","Tarea borrada correctamente"),e=e.filter(e=>e.id!=o),t()):r("error","Oops..","La tarea no se pudo borrar")}(a)})}(s)}})}function a(a=!1,c){const s=document.createElement("DIV");s.classList.add("modal"),s.innerHTML=`\n            <form class="formulario nueva-tarea">\n                <legend>${a?"Editar tarea":"A単ade una nueva tarea"}</legend>\n                <div class="campo">\n                    <label>Tarea</label>\n                    <input type="tarea" name="tarea" placeholder="${a?"Editar tarea":"A単ade una nueva tarea al proyecto actual"}" id="tarea" value="${c?c.nombre:""}"/>\n                </div>\n                <div class="opciones">\n                    <input type="submit" class="submit-nueva-tarea" value="${a?"Guardar los cambios":"A単ade una nueva tarea"}"/>\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>\n            </form>\n        `,setTimeout(()=>{document.querySelector(".formulario").classList.add("animar")},0),s.addEventListener("click",i=>{if(i.preventDefault(),i.target.classList.contains("cerrar-modal")||i.target.classList.contains("modal")){document.querySelector(".formulario").classList.add("cerrar"),setTimeout(()=>{s.remove()},500)}if(i.target.classList.contains("submit-nueva-tarea")){const s=document.querySelector("#tarea").value.trim();if(""===c)return void function(e,t,a){const o=document.querySelector(".alerta");o&&o.remove();const n=document.createElement("DIV");n.classList.add("alerta",t),n.textContent=e,a.parentElement.insertBefore(n,a.nextElementSibling),setTimeout(()=>{n.remove()},6e3)}("El nombre de la tarea es obligatorio","error",document.querySelector(".formulario legend"));if(!a)return void async function(a){const o=new FormData;o.append("nombre",a),o.append("idProyecto",n());try{const n="http://localhost:3000/api/tarea",c=await fetch(n,{method:"POST",body:o}),s=await c.json();if(r("success","Exito","Tarea creada correctamente"),"exito"===s.tipo){const o={id:s.id.toString(),nombre:a,estado:"0",idProyecto:s.idProyecto};e=[...e,o],t();const n=document.querySelector(".modal");n&&n.remove()}}catch(e){console.log(e)}}(s);c.nombre=s,o(c)}}),document.querySelector(".dashboard").appendChild(s)}async function o(a){const{id:o,estado:c,nombre:s}=a,i=new FormData;i.append("id",o),i.append("nombre",s),i.append("estado",c),i.append("urlProyecto",n());try{const a="http://localhost:3000/api/tarea/actualizar",n=await fetch(a,{method:"POST",body:i});if("exito"===(await n.json()).tipo){r("success","Exito","Tarea actualizada correctamente"),e=e.map(e=>(e.id===o&&(console.log(e.estado),e.estado=c,e.nombre=s,console.log(e.estado=c)),e));const a=document.querySelector(".modal");a&&a.remove(),t()}}catch(e){console.log(e)}}function n(){const e=new URLSearchParams(window.location.search);return Object.fromEntries(e.entries()).urlProyecto}function r(e,t,a){Swal.fire({icon:e,title:t,text:a,button:"OK"})}document.querySelector("#agregar-tarea").addEventListener("click",()=>{a()})})();